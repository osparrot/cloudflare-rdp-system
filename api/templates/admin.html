<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin & Auditing Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f7f9; color: #333; }
        .container { max-width: 1400px; margin: 50px auto; padding: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        header { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        header h1 { color: #dc3545; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; font-size: 0.9em; }
        th { background-color: #f8f9fa; color: #495057; }
        tr:hover { background-color: #f1f1f1; }
        .status-active { color: #28a745; font-weight: bold; }
        .status-cleaned, .status-expired_cleaned { color: #6c757d; }
        .status-cleanup_failed { color: #ffc107; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
        .button { padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-decoration: none; display: inline-block; text-align: center; font-size: 0.8em; }
        .btn-revoke { background-color: #dc3545; color: white; }
        .error { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Admin & Auditing Dashboard</h1>
            <p>View all sessions, audit logs, and manage active sessions.</p>
        </header>

        {% if error %}
            <p class="error">Error: {{ error }}</p>
        {% endif %}

        <h2>All Sessions (Last 50)</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>User ID</th>
                    <th>Session Sub</th>
                    <th>FQDN</th>
                    <th>Status</th>
                    <th>Created At</th>
                    <th>Expires At</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for session in all_sessions %}
                <tr>
                    <td>{{ session.id }}</td>
                    <td>{{ session.user_id }}</td>
                    <td>{{ session.session_sub }}</td>
                    <td>{{ session.fqdn }}</td>
                    <td><span class="status-{{ session.status }}">{{ session.status.upper() }}</span></td>
                    <td>{{ session.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>{{ session.expires_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td>
                        {% if session.status == 'active' %}
                            <form method="post" action="/sessions/{{ session.session_sub }}/delete" style="display: inline;">
                                <button type="submit" class="button btn-revoke">Revoke</button>
                            </form>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <p style="margin-top: 30px;">**Note on Auditing:** The `rdp_password` is stored in the database for the user to retrieve. Auditing "who revealed passwords" and "Cloudflare Access logs" would require additional logging features in the API and integration with Cloudflare's log push service, which is beyond the scope of this initial setup.</p>
    </div>
</body>
</html>
